Small refactoring exercise in C++ to make a class easier to test